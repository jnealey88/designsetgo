document.addEventListener("DOMContentLoaded",function(){function e(e,t,s){e.textContent=t,e.className=`dsg-form__message dsg-form__message--${s}`,e.style.display="block",e.setAttribute("role","error"===s?"alert":"status");const r=document.createElement("span");r.className="screen-reader-text",r.textContent=t,r.setAttribute("aria-live","polite"),e.appendChild(r)}document.querySelectorAll(".dsg-form-builder").forEach(t=>{const s=t.querySelector(".dsg-form"),r=s?.querySelector(".dsg-form__submit"),a=s?.querySelector(".dsg-form__message");if(!s||!r||!a)return;const o=document.createElement("input");if(o.type="hidden",o.name="dsg_timestamp",o.value=Date.now(),s.appendChild(o),"true"!==t.getAttribute("data-ajax-submit"))return;const i=t.getAttribute("data-form-id"),n=t.getAttribute("data-success-message"),m=t.getAttribute("data-error-message"),d=t.getAttribute("data-enable-email"),l=t.getAttribute("data-email-to"),u=t.getAttribute("data-email-subject"),c=t.getAttribute("data-email-from-name"),g=t.getAttribute("data-email-from-email"),b=t.getAttribute("data-email-reply-to"),f=t.getAttribute("data-email-body");s.addEventListener("submit",async function(o){var _;if(o.preventDefault(),(_=a).style.display="none",_.textContent="",_.className="dsg-form__message",!s.checkValidity())return void s.reportValidity();r.disabled=!0,r.classList.add("dsg-form__submit--loading");const p=r.textContent;r.setAttribute("aria-busy","true");const y=new FormData(s),h=[];for(const[e,t]of y.entries()){if("dsg_website"===e||"dsg_form_id"===e||"dsg_timestamp"===e)continue;const r=s.querySelector(`[name="${e}"]`),a=r?.getAttribute("data-field-type")||r?.type||"text";h.push({name:e,value:t,type:a})}const A=y.get("dsg_website"),w=y.get("dsg_timestamp");try{const r=await fetch(designsetgoForm.restUrl,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":designsetgoForm.nonce},body:JSON.stringify({formId:i,fields:h,honeypot:A||"",timestamp:w||Date.now(),enable_email:d,email_to:l,email_subject:u,email_from_name:c,email_from_email:g,email_reply_to:b,email_body:f})}),o=await r.json();if(!o.success)throw new Error(o.message||m);e(a,n||o.message,"success"),s.reset(),t.dispatchEvent(new CustomEvent("dsgFormSubmitted",{detail:{formId:i,submissionId:o.submissionId},bubbles:!0})),function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(a)||a.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(s){console.error("Form submission error:",s),e(a,s.message||m||"An error occurred. Please try again.","error"),t.dispatchEvent(new CustomEvent("dsgFormError",{detail:{formId:i,error:s.message},bubbles:!0}))}finally{r.disabled=!1,r.classList.remove("dsg-form__submit--loading"),r.textContent=p,r.removeAttribute("aria-busy")}})})});