# External Integrations

**Analysis Date:** 2026-02-26

## APIs & External Services

**Mapping:**
- OpenStreetMap (tile server) - Default map provider for the Map block
  - Tile URL: `https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`
  - SDK/Client: `leaflet` ^1.9.4 (bundled in `build/blocks/map/view.js`)
  - Auth: None required
  - Handler: `src/blocks/map/handlers/openstreetmap-handler.js`

- Nominatim (OpenStreetMap geocoding) - Address-to-coordinate lookup in editor and frontend
  - Geocode URL: `https://nominatim.openstreetmap.org/search`
  - Reverse geocode URL: `https://nominatim.openstreetmap.org/reverse`
  - Auth: None required (public API; rate-limited by user-agent)
  - Handler: `src/blocks/map/utils/geocoding.js`

- Google Maps JavaScript API - Optional map provider for the Map block
  - Script URL: `https://maps.googleapis.com/maps/api/js`
  - SDK/Client: Dynamic script loader at `src/blocks/map/utils/script-loader.js`
  - Auth: `dsgoIntegrations.googleMapsApiKey` (injected server-side via `wp_localize_script`)
  - API key stored in: `designsetgo_settings['integrations']['google_maps_api_key']`
  - PHP injection: `includes/class-plugin.php` → `inject_map_api_key()`
  - Handler: `src/blocks/map/handlers/googlemaps-handler.js`
  - Note: API key is client-side (designed to be public); security via Google Cloud HTTP referrer restrictions

**Security/CAPTCHA:**
- Cloudflare Turnstile - Optional CAPTCHA for Form Builder submissions
  - Verification URL: `https://challenges.cloudflare.com/turnstile/v0/siteverify`
  - Auth: `turnstile_site_key` (frontend) and `turnstile_secret_key` (server-side secret)
  - Keys stored in: `designsetgo_settings['integrations']['turnstile_site_key']` and `['turnstile_secret_key']`
  - PHP verification: `includes/blocks/class-form-security.php` → `verify_turnstile()`
  - Outbound HTTP call: `wp_remote_post()` with 5-second timeout
  - Graceful degradation: if secret key missing or Cloudflare unreachable, submission passes

## Data Storage

**Databases:**
- WordPress MySQL/MariaDB (via WordPress `$wpdb`)
  - Connection: Managed entirely by WordPress (no direct DB credentials in plugin)
  - Client: WordPress `$wpdb` abstraction; `$wpdb->prepare()` required for all queries
  - Plugin data:
    - `wp_options` table: `designsetgo_settings` (all plugin settings), `designsetgo_global_styles`, `designsetgo_llms_txt_physical`, `designsetgo_llms_txt_full_physical`
    - `wp_posts` custom post type: `dsgo_form_submission` (form submission storage)
    - WordPress transients: Rate limiting counters (`form_submit_{formId}_{md5(ip)}`)

**File Storage:**
- Local filesystem only
  - `llms.txt` / `llms-full.txt` optionally written to WordPress ABSPATH (`ABSPATH . 'llms.txt'`)
  - Build artifacts in `build/` (not committed, generated by `npm run build`)

**Caching:**
- WordPress Transients API (database-backed)
  - Form submission rate limits: `form_submit_{formId}_{md5(ip)}`, TTL = 60 seconds (configurable)
  - llms.txt content: `designsetgo_llms_txt_cache` / `designsetgo_llms_full_txt_cache`, TTL = 1 day
  - Form block attributes: cached per-post, invalidated on `save_post`
- webpack filesystem cache: `node_modules/.cache/webpack/` (dev builds only)

## Authentication & Identity

**Auth Provider:**
- WordPress native authentication only
  - All admin REST API endpoints require `manage_options` capability
  - Form submission endpoint (`/designsetgo/v1/form/submit`) is intentionally public
  - Draft mode uses WordPress nonce verification
  - Block revision comparison requires `edit_posts` capability

## Monitoring & Observability

**Error Tracking:**
- Codecov - Coverage reporting from CI (`codecov/codecov-action@v4` in `.github/workflows/ci.yml`)
  - Uploads `coverage/lcov.info` on unit test runs; set to `continue-on-error: true`
  - Sentry packages are present in `node_modules` (transitive dep via `@wordpress/scripts`), not directly used

**Logs:**
- WordPress `WP_DEBUG_LOG` - PHP errors logged to `wp-content/debug.log` in development
- Turnstile verification errors logged via `error_log()` when `WP_DEBUG` is true
- Form security events exposed via WordPress action hooks (not logged by default):
  - `designsetgo_form_spam_detected`
  - `designsetgo_form_rate_limit_exceeded`
  - `designsetgo_form_validation_failed`
  - `designsetgo_form_submitted`
  - `designsetgo_form_email_sent`
  - `designsetgo_form_turnstile_failed`

## CI/CD & Deployment

**Hosting:**
- WordPress.org Plugin Directory (SVN-based distribution)
  - Slug: `designsetgo`

**CI Pipeline:**
- GitHub Actions (`.github/workflows/ci.yml`) on `push`/`pull_request` to `main`:
  - Build (Node 20, `npm run build`, bundle size checks, artifact upload)
  - Lint & Unit Tests (JS lint, CSS lint, `npm run test:unit`)
  - PHP Lint & Analysis (matrix: PHP 8.0/8.1/8.2/8.3, PHPCS + PHPStan)
  - Security Audit (`npm audit --audit-level=critical`)
  - Dependency Review (PR only, fails on critical severity)
  - E2E Tests (Playwright Chromium against `wp-env`, WordPress 6.9)
  - WordPress Compatibility (matrix: PHP 8.0-8.3 × WordPress 6.7/6.8/6.9/latest)

**Deploy Workflows:**
- `.github/workflows/deploy.yml` - Triggers on git tag push; builds and deploys to WordPress.org SVN
- `.github/workflows/deploy-assets.yml` - Assets-only SVN deploy
  - Secrets required: `SVN_USERNAME`, `SVN_PASSWORD` (WordPress.org credentials)

**AI Code Review:**
- `.github/workflows/claude.yml` - Claude Code automated review on PR comments (`@claude review` or `/review`)
- `.github/workflows/claude-code-review.yml` - Claude Code review on PR submission
  - Secret required: `CLAUDE_CODE_OAUTH_TOKEN` (Anthropic OAuth token)

**Wiki Sync:**
- `.github/workflows/sync-wiki.yml` - Syncs docs to GitHub Wiki
  - Secret required: `WIKI_PAT` (GitHub Personal Access Token)

## Webhooks & Callbacks

**Incoming:**
- `POST /wp-json/designsetgo/v1/form/submit` - Public form submission endpoint
  - Accepts: `formId`, `fields[]`, `honeypot`, `timestamp`, `turnstileToken` (optional)
  - Response: JSON success/error with HTTP status codes
- `GET/POST /wp-json/designsetgo/v1/settings` - Plugin settings CRUD (admin only)
- `GET/POST /wp-json/designsetgo/v1/global-styles` - Global styles CRUD (admin only)
- `POST /wp-json/designsetgo/v1/draft` - Draft mode create/update/delete (editor only)
- `GET /wp-json/designsetgo/v1/revisions/*` - Block revision comparison (editor only)
- `GET/POST /wp-json/designsetgo/v1/gdpr/*` - GDPR data export/delete (admin only)
- `GET/POST /wp-json/designsetgo/v1/llms-txt/*` - llms.txt content management (admin only)

**Outgoing:**
- `https://challenges.cloudflare.com/turnstile/v0/siteverify` - Turnstile token verification (server-to-server, triggered per form submission when configured)

## Optional Third-Party Plugin Integrations

**WooCommerce:**
- `designsetgo/product-showcase-hero` block only registers when `class_exists('WooCommerce')` is true
- Gated in `includes/class-plugin.php` → `gate_woocommerce_blocks()`
- Default fresh-install exclusion list includes `woocommerce/*` blocks from extensions

**Known Compatible Plugins (exclusion defaults):**
- GravityForms (`gravityforms/*`) - excluded from extensions by default on fresh installs
- MailPoet (`mailpoet/*`) - excluded from extensions by default on fresh installs
- Jetpack (`jetpack/*`) - excluded from extensions by default on fresh installs

---

*Integration audit: 2026-02-26*
