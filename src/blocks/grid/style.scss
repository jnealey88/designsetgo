/**
 * Grid Container Block - Frontend Styles
 *
 * Frontend styles for the Grid Container block with responsive columns.
 *
 * @package DesignSetGo
 */

.dsg-grid {
	// CRITICAL: Ensure width includes padding to prevent overflow
	// When width: 100% is set, padding must be included in the total width
	box-sizing: border-box;

	// Smooth transition for hover background color
	transition: background-color 0.3s ease;

	// Default padding (theme-level): xl top/bottom, m left/right
	// Users can override via WordPress padding controls
	// When padding is set to "Default", these theme values apply
	padding-top: var(--wp--preset--spacing--xl, 3rem);
	padding-bottom: var(--wp--preset--spacing--xl, 3rem);
	padding-left: var(--wp--preset--spacing--md, 1.5rem);
	padding-right: var(--wp--preset--spacing--md, 1.5rem);

	// CRITICAL: Nested containers should have no padding to prevent overflow
	// Only parent containers should have padding
	.dsg-stack > &,
	.dsg-flex > &,
	.dsg-grid > & {
		padding: 0;
	}

	// Let WordPress handle outer wrapper sizing for alignfull support
	// align-self: stretch (default) fills parent without overflow

	// CRITICAL: Prevent grid items from overflowing their cells
	// Grid items automatically fill their grid cell, so we only need to prevent overflow
	> * {
		min-width: 0;     // Allow shrinking below content width
		min-height: 0;    // Allow shrinking vertically
	}

	// CRITICAL: Block-level elements need full width for text-align to work properly
	// Only apply to text blocks, not buttons or inline elements
	// NOTE: Nested containers (.dsg-flex, .dsg-grid, .dsg-stack) don't need width: 100%
	// because grid items automatically fill their cell
	> h1,
	> h2,
	> h3,
	> h4,
	> h5,
	> h6,
	> p,
	> .wp-block-heading,
	> .wp-block-paragraph {
		width: 100%;
	}

	// Responsive column classes
	// Desktop columns are set via inline styles (default)
	// Tablet and mobile columns use media queries

	// Tablet breakpoint (≤ 1024px)
	@media (max-width: 1024px) {

		@for $i from 1 through 12 {
			&.dsg-grid-cols-tablet-#{$i} {
				grid-template-columns: repeat(#{$i}, 1fr) !important;
			}
		}
	}

	// Mobile breakpoint (≤ 767px)
	@media (max-width: 767px) {

		@for $i from 1 through 12 {
			&.dsg-grid-cols-mobile-#{$i} {
				grid-template-columns: repeat(#{$i}, 1fr) !important;
			}
		}
	}

	// Hover background and text colors using CSS custom properties
	// CRITICAL: Only apply hover when variables are actually set on THIS element
	// This prevents hover bleeding to adjacent containers that don't have hover settings
	&:hover {
		// Only apply background if hover background is set
		&[style*="--dsg-hover-bg-color"] {
			background-color: var(--dsg-hover-bg-color);
		}

		// Only apply text color if hover text color is set
		// Use !important to override custom text colors set by users
		&[style*="--dsg-hover-text-color"] {
			color: var(--dsg-hover-text-color) !important;

			// Apply text color to all text elements for consistency
			// !important needed to override custom color classes/inline styles
			h1, h2, h3, h4, h5, h6, p, a, span, li, td, th,
			.wp-block-heading,
			.wp-block-paragraph {
				color: var(--dsg-hover-text-color) !important;
			}
		}
	}
}

// CRITICAL: Force grid items to respect responsive column counts on tablet
// Must be outside .dsg-grid scope for proper specificity
@media (max-width: 1024px) and (min-width: 768px) {
	// For each possible tablet column configuration, constrain column spans
	// This duplicates the grid-span extension logic but with additional selectors for higher specificity
	@for $cols from 1 through 12 {
		// Target grids with this tablet column count
		.dsg-grid-cols-tablet-#{$cols} {
			// Force any child with grid-column spanning more than available columns
			// to constrain to the tablet column count
			@for $span from ($cols + 1) through 12 {
				> *[style*="grid-column: span #{$span}"],
				> *[style*="gridColumn:span#{$span}"],
				> *[style*="grid-column:span #{$span}"],
				> [data-block][style*="grid-column: span #{$span}"],
				> [data-block][style*="gridColumn:span#{$span}"],
				> [data-block][style*="grid-column:span #{$span}"] {
					grid-column: span #{$cols} !important;
				}
			}
		}
	}
}

// CRITICAL: Force grid items and nested layouts to stack properly on mobile
// Must be outside .dsg-grid scope for proper specificity
@media (max-width: 767px) {
	// Force all grid items with column spans to span 1 on mobile
	// High specificity to override inline styles
	.dsg-grid > [style*="grid-column"],
	.dsg-grid > [data-block][style*="grid-column"],
	.dsg-grid > [data-block] {
		grid-column: span 1 !important;
	}

	// Force nested layouts inside grid items to stack
	.dsg-grid > * {
		// Force any nested grid to single column
		.dsg-grid {
			grid-template-columns: 1fr !important;
		}

		// Force any nested flex to stack vertically
		.dsg-flex {
			flex-direction: column !important;
		}
	}
}

/**
 * Layout-Constrained Margin Rules
 * Matches WordPress Group block behavior for proper spacing
 * Applied when layout support is enabled (type: constrained)
 *
 * CRITICAL: Uses :where() for zero specificity to allow WordPress's natural
 * cascade and blockGap system to work properly.
 */

// First child should have no top margin
:root :where(.dsg-grid.is-layout-constrained) > :first-child {
	margin-block-start: 0;
}

// All children get consistent spacing
:root :where(.dsg-grid.is-layout-constrained) > * {
	margin-block-start: 0;
	margin-block-end: 0;
}

// Last child should have no bottom margin
:root :where(.dsg-grid.is-layout-constrained) > :last-child {
	margin-block-end: 0;
}
