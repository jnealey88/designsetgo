/**
 * DSG Grid Block - Editor Styles
 *
 * Editor-only styles for the DSG Grid block.
 * CRITICAL: Responsive column styles must be duplicated from style.scss
 * for editor/frontend parity.
 *
 * @package DesignSetGo
 */

.dsgo-grid {
	// CRITICAL: Ensure width includes padding to prevent overflow
	// Must match style.scss for editor/frontend parity
	box-sizing: border-box;

	// CRITICAL: Must duplicate from style.scss for editor/frontend parity
	// Smooth transition for hover background color
	transition: background-color 0.3s ease;

	// CRITICAL: Must duplicate default padding from style.scss for editor/frontend parity
	// Default padding using WP standard spacing slugs
	// Fallback values match block.json defaults for consistency
	padding-top: var(--wp--preset--spacing--50, 2rem);
	padding-bottom: var(--wp--preset--spacing--50, 2rem);
	padding-left: var(--wp--preset--spacing--30, 1rem);
	padding-right: var(--wp--preset--spacing--30, 1rem);

	// CRITICAL: Nested containers should have no padding to prevent overflow
	// Must be duplicated from style.scss for editor/frontend parity
	// Only parent containers should have padding
	.dsgo-stack__inner > &,
	.dsgo-flex__inner > &,
	.dsgo-grid > &,
	.dsgo-stack__inner > [data-block] &,
	.dsgo-flex__inner > [data-block] &,
	.dsgo-grid > [data-block] & {
		padding: 0;
	}

	// CRITICAL: Ensure Grid takes full width when nested in another container
	// Without this, nested Grids only take up content width in editor
	.dsgo-stack__inner > [data-block] &,
	.dsgo-flex__inner > [data-block] &,
	.dsgo-grid > [data-block] & {
		width: 100% !important;
	}

	// Visual indicator in editor
	position: relative;

	// CRITICAL: Handle full-width and wide alignment in editor
	// WordPress automatically adds .alignfull and .alignwide classes when user selects alignment
	&.alignfull {
		max-width: none;
		width: 100%;
		margin-left: 0;
		margin-right: 0;
	}

	&.alignwide {
		max-width: var(--wp--custom--layout--wide-size, 1200px);
		width: 100%;
		margin-left: auto;
		margin-right: auto;
	}

	// Inner container handles all grid styling
	// With two-div structure: .dsgo-grid > .dsgo-grid__inner
	// Must be duplicated from style.scss for editor/frontend parity
	.dsgo-grid__inner {
		// Ensure inner container doesn't create positioning context for absolute children
		position: static;

		// CRITICAL: Prevent grid items from overflowing their cells
		// Grid items automatically fill their grid cell, so we only need to prevent overflow
		> * {
			min-width: 0;     // Allow shrinking below content width
			min-height: 0;    // Allow shrinking vertically
		}

		// CRITICAL: Block-level text elements need full width for text-align to work properly
		> h1,
		> h2,
		> h3,
		> h4,
		> h5,
		> h6,
		> p,
		> .wp-block-heading,
		> .wp-block-paragraph {
			width: 100%;
		}

		// CRITICAL: Editor-specific - text elements wrapped in [data-block]
		> [data-block] > h1,
		> [data-block] > h2,
		> [data-block] > h3,
		> [data-block] > h4,
		> [data-block] > h5,
		> [data-block] > h6,
		> [data-block] > p,
		> [data-block] > .wp-block-heading,
		> [data-block] > .wp-block-paragraph {
			width: 100%;
		}

		// CRITICAL: Container blocks need !important to override WordPress layout system
		// WordPress's constrained layout can apply max-width to nested containers
		> .dsgo-flex,
		> .dsgo-stack,
		> .dsgo-grid {
			width: 100% !important;
		}

		// CRITICAL: Editor-specific - nested containers wrapped in [data-block]
		// WordPress wraps each block in [data-block] element in editor
		> [data-block] > .dsgo-flex,
		> [data-block] > .dsgo-stack,
		> [data-block] > .dsgo-grid {
			width: 100% !important;
		}
	}

	// CRITICAL: When grid has content, position appender at outer container corner
	// Target from outer container to position relative to main block wrapper
	// Use :not(:only-child) to exclude empty grid state
	/* stylelint-disable-next-line selector-class-pattern */
	.dsgo-grid__inner > .block-list-appender:not(:only-child) {
		// Remove from grid flow and position at outer container corner
		position: absolute;
		right: 0;
		bottom: 0;
		// Allow inserter button to position naturally
		width: auto;
		height: auto;
	}

	// CRITICAL: When grid is empty, show full-width appender
	/* stylelint-disable-next-line selector-class-pattern */
	.dsgo-grid__inner > .block-list-appender:only-child {
		width: 100%;
		grid-column: 1 / -1; // Span all columns
		position: static; // Reset positioning
	}

	// CRITICAL: When Grid is nested inside Section/Stack/Flex, force full width (EDITOR)
	// WordPress applies constrained layout which can limit width
	// This ensures nested Grids take full width of their parent container
	// In editor, blocks are wrapped in [data-block] elements
	.dsgo-stack__inner > &,
	.dsgo-stack__inner > [data-block] &,
	.dsgo-flex__inner > &,
	.dsgo-flex__inner > [data-block] &,
	.dsgo-grid__inner > &,
	.dsgo-grid__inner > [data-block] & {
		width: 100% !important;

		.dsgo-grid__inner {
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}
	}

	// Show outline when selected (editor-only)
	&.is-selected {
		outline: 1px dashed rgba(37, 99, 235, 0.3);
		outline-offset: -1px;
	}

	// ========================================
	// CRITICAL: Responsive column classes
	// MUST be duplicated from style.scss for editor/frontend parity
	// Desktop columns are set via inline styles (default)
	// Tablet and mobile columns use media queries
	// CRITICAL: Target .dsgo-grid__inner since that's where grid-template-columns is applied
	// ========================================

	// Tablet breakpoint (≤ 1024px)
	@media (max-width: 1024px) {

		@for $i from 1 through 12 {
			&.dsgo-grid-cols-tablet-#{$i} .dsgo-grid__inner {
				grid-template-columns: repeat(#{$i}, 1fr) !important;
			}
		}
	}

	// Mobile breakpoint (≤ 767px)
	@media (max-width: 767px) {

		@for $i from 1 through 12 {
			&.dsgo-grid-cols-mobile-#{$i} .dsgo-grid__inner {
				grid-template-columns: repeat(#{$i}, 1fr) !important;
			}
		}
	}

	// CRITICAL: Must duplicate from style.scss for editor/frontend parity
	// Hover background and text colors using CSS custom properties
	// CRITICAL: Only apply hover when variables are actually set on THIS element
	// This prevents hover bleeding to adjacent containers that don't have hover settings
	&:hover {
		// Only apply background if hover background is set
		// !important needed to override WordPress color classes and gradients
		// Use 'background' instead of 'background-color' to override gradients
		&[style*="--dsgo-hover-bg-color"] {
			background: var(--dsgo-hover-bg-color) !important;
		}

		// Only apply text color if hover text color is set
		// Use !important to override custom text colors set by users
		&[style*="--dsgo-hover-text-color"] {
			color: var(--dsgo-hover-text-color) !important;

			// Apply text color to all text elements for consistency
			// !important needed to override custom color classes/inline styles
			h1, h2, h3, h4, h5, h6, p, a, span, li, td, th,
			.wp-block-heading,
			.wp-block-paragraph {
				color: var(--dsgo-hover-text-color) !important;
			}
		}
	}
}

// ===================================================================
// PERFORMANCE OPTIMIZATION (2025-11-11)
// ===================================================================
// Tablet grid-column span constraints are now handled by JavaScript (view.js)
// In the editor, spans are visible at desktop width so no constraints needed
// On frontend, view.js handles responsive span constraints dynamically
// This eliminates 396 CSS rules (66KB) from editor styles
// ===================================================================

// CRITICAL: Force grid items and nested layouts to stack properly on mobile
// Must be outside .dsgo-grid scope for proper specificity
// MUST be duplicated from style.scss for editor/frontend parity
// With two-div structure: target .dsgo-grid__inner children
@media (max-width: 767px) {
	// Force all grid items with column spans to span 1 on mobile
	// High specificity to override inline styles with data-block selectors
	.dsgo-grid__inner > [style*="grid-column"],
	.dsgo-grid__inner > [data-block][style*="grid-column"],
	.dsgo-grid__inner > [data-block] {
		grid-column: span 1 !important;
	}

	// Force nested layouts inside grid items to stack
	.dsgo-grid__inner > * {
		// Force any nested grid to single column
		.dsgo-grid {
			grid-template-columns: 1fr !important;
		}

		// Force any nested flex to stack vertically
		.dsgo-flex__inner {
			flex-direction: column !important;
		}
	}
}

// ========================================
// Hide padding controls for nested containers
// When a container is nested inside another container, padding should default to 0
// Only parent containers should have padding controls visible
// Uses CSS to detect if a grid is nested inside any container block
// With two-div structure: check for .dsgo-grid__inner parent
// ========================================
body:has(.dsgo-grid__inner .dsgo-grid.is-selected),
body:has(.dsgo-flex__inner .dsgo-grid.is-selected),
body:has(.dsgo-stack__inner .dsgo-grid.is-selected) {
	// Hide padding controls in Dimensions panel
	.block-editor-block-inspector__advanced
		.components-panel__body:has(.components-base-control:has([aria-label*='Padding' i])) {

		.components-base-control:has([aria-label*='Padding' i]) {
			display: none !important;
		}
	}
}

// ========================================
// Layout-Constrained Margin Rules (EDITOR)
// CRITICAL: Override WordPress's margin-based spacing for Grid layouts
// Grid uses CSS gap properties, not margins, for spacing
// Must be duplicated from style.scss for editor/frontend parity
// With two-div structure: .dsgo-grid > .dsgo-grid__inner > items
// ========================================

// Remove all margin-block spacing from grid items
// CRITICAL: !important needed to override WordPress's layout system
// Target inner container's children since we now have two-div structure
.dsgo-grid__inner > * {
	margin-block-start: 0 !important;
	margin-block-end: 0 !important;
}

// Also target data-block wrapped elements in editor
.dsgo-grid__inner > [data-block] {
	margin-block-start: 0 !important;
	margin-block-end: 0 !important;
}
