/**
 * DSG Row Block - Frontend Styles
 *
 * Frontend styles for the DSG Row block.
 *
 * @package DesignSetGo
 */

.dsgo-flex {
	// CRITICAL: Ensure width includes padding/border to prevent overflow
	box-sizing: border-box;

	// Container display - WordPress handles flex layout through native layout support
	// We only need to override specific behaviors

	position: relative;
	overflow: visible;

	// Smooth transition for hover background color
	transition: background-color 0.3s ease;

	/**
	 * Background overlay
	 * Only rendered when overlay color is set
	 */
	&.dsgo-flex--has-overlay {
		overflow: hidden;

		&::before {
			content: '';
			position: absolute;
			inset: 0;
			background-color: var(--dsgo-overlay-color);
			opacity: var(--dsgo-overlay-opacity, 0.8);
			pointer-events: none;
			z-index: 1;
		}

		> .dsgo-flex__inner {
			position: relative;
			z-index: 2;
		}
	}

	// CRITICAL: Allow Navigation block dropdowns to overflow even with overlay
	// Navigation menus need to display outside container bounds
	&:has(.wp-block-navigation) {
		overflow: visible;
	}

	// CRITICAL: Inner container must be full width for justify-content to work
	// When constrainWidth is enabled, inline styles will override with max-width
	.dsgo-flex__inner {
		width: 100%;
	}

	// CRITICAL: When Row/Flex is nested inside another container, force full width
	// WordPress applies constrained layout which can limit width
	// This ensures nested Rows take full width of their parent container
	.dsgo-stack__inner > &,
	.dsgo-flex__inner > &,
	.dsgo-grid__inner > & {
		width: 100% !important;

		.dsgo-flex__inner {
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}
	}

	// CRITICAL: Fix flex children behavior
	// With two-div structure, flex children are inside .dsgo-flex__inner
	.dsgo-flex__inner > * {
		// Disable float - WordPress core CSS applies float: right/left for alignment classes
		// This breaks flex layout, so we override it
		float: none !important;

		// Remove auto margins - WordPress adds margin-left/right: auto when contentSize is set
		// This breaks justify-content alignment
		margin-left: 0 !important;
		margin-right: 0 !important;

		// Remove margin-block-start - WordPress adds this but we want to use gap instead
		// This makes spacing behave like the core Row block
		margin-block-start: 0 !important;

		// CRITICAL: Support WordPress width controls (fit/grow/fixed)
		// Allow flex-basis, flex-grow, flex-shrink from WordPress layout support
		// These are applied as inline styles by WordPress
		// Explicitly set flex-shrink to allow shrinking when needed
		flex-shrink: 1;
		// Set min-width to 0 to allow flex items to shrink below content size
		min-width: 0;
	}

	// Mobile stack behavior (screens < 768px)
	&--mobile-stack {

		@media (max-width: 767px) {
			flex-direction: column !important;
		}
	}

	// CRITICAL: Override WordPress width constraints when constrainWidth is disabled
	// The WordPress container class is on the INNER div, not the outer div
	// We need higher specificity to override this
	// IMPORTANT: Only apply when .dsgo-no-width-constraint class is present (constrainWidth is disabled)
	&.alignfull.dsgo-no-width-constraint > .dsgo-flex__inner[class*="wp-container-"] {
		// Target all direct children that aren't explicitly aligned
		> :not(.alignleft):not(.alignright) {
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}
	}

	// Hover background and text colors using CSS custom properties
	// CRITICAL: Only apply hover when variables are actually set on THIS element
	// This prevents hover bleeding to adjacent containers that don't have hover settings
	&:hover {
		// Only apply background if hover background is set
		// !important needed to override WordPress color classes and gradients
		// Use 'background' instead of 'background-color' to override gradients
		&[style*="--dsgo-hover-bg-color"] {
			background: var(--dsgo-hover-bg-color) !important;
		}

		// Only apply text color if hover text color is set
		// Use !important to override custom text colors set by users
		&[style*="--dsgo-hover-text-color"] {
			color: var(--dsgo-hover-text-color) !important;

			// Apply text color to all text elements for consistency
			// !important needed to override custom color classes/inline styles
			h1,
			h2,
			h3,
			h4,
			h5,
			h6,
			p,
			a,
			span,
			li,
			td,
			th,
			.wp-block-heading,
			.wp-block-paragraph {
				color: var(--dsgo-hover-text-color) !important;
			}
		}
	}
}
