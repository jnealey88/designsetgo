/**
 * Icon Block - Frontend Styles
 *
 * Dashicon display with optional shapes and links
 */

.dsg-icon {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	width: fit-content; // Ensure block only takes space needed for icon + padding
	max-width: fit-content; // Prevent expansion beyond content
	// Background color will be inherited by child .dsg-icon__wrapper
	// No need to force transparent here

	// Link wrapper
	&__link {
		display: inline-flex;
		text-decoration: none;
		color: inherit;
		transition: transform 0.2s ease, opacity 0.2s ease;

		&:hover {
			transform: scale(1.1);
			opacity: 0.8;
		}

		&:focus {
			outline: none;
		}
	}

	// Icon wrapper
	&__wrapper {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		line-height: 1;
		color: currentcolor;
		transition: background-color 0.2s ease, color 0.2s ease;
		width: fit-content;

		/* stylelint-disable-next-line selector-class-pattern */
		.dashicons {
			display: block;
			width: 1em;
			height: 1em;
			font-size: inherit;
			line-height: 1;
			transition: transform 0.2s ease;
		}

		// Ensure shapes are square (1:1 aspect ratio)
		/* stylelint-disable selector-class-pattern */
		&.shape-circle,
		&.shape-square,
		&.shape-rounded {
			aspect-ratio: 1;
		}

		// Shape variants
		&.shape-circle {
			border-radius: 50%;
		}

		&.shape-square {
			border-radius: 0;
		}

		&.shape-rounded {
			border-radius: 8px;
		}
		/* stylelint-enable selector-class-pattern */
	}

	// Alignment variants
	&.alignleft {
		margin-right: 1em;
	}

	&.alignright {
		margin-left: 1em;
	}

	&.aligncenter {
		display: flex;
		justify-content: center;
		margin-left: auto;
		margin-right: auto;
	}

	// Ensure proper color inheritance from WordPress color controls
	// Use background-color instead of background shorthand to avoid conflicts with hover
	&[style*="background-color"]:not([style*="background-image"]) .dsg-icon__wrapper {
		background-color: inherit !important;
	}

	// For background images, inherit full background
	&[style*="background-image"] .dsg-icon__wrapper {
		background: inherit !important;
	}

	// Transfer background from WordPress color classes (e.g., has-warning-background-color)
	&.has-background .dsg-icon__wrapper {
		background-color: transparent !important;
	}

	// Accessibility: Respect prefers-reduced-motion
	@media (prefers-reduced-motion: reduce) {
		/* stylelint-disable selector-class-pattern */
		&__link,
		&__wrapper,
		.dashicons {
			transition: none;
		}
		/* stylelint-enable selector-class-pattern */

		&__link:hover {
			transform: none;
		}
	}
}

// Outlined icon style
.dsg-icon-outlined {

	svg {
		fill: none !important;
		stroke: currentcolor;
		stroke-width: var(--icon-stroke-width, 1.5);
		stroke-linecap: round;
		stroke-linejoin: round;

		// Ensure all paths and shapes use stroke
		* {
			fill: none !important;
			stroke: currentcolor;
		}
	}
}

// Parent container hover: apply icon background when parent is hovered
// Uses CSS variable set by parent container (Flex, Grid, Stack)
// CRITICAL: Check if PARENT container has the variable, not the icon itself
// CRITICAL: Use __inner wrapper to avoid triggering on outer padding areas
// CRITICAL: Exclude icons that are inside nested containers
// This changes the block's background color, which the wrapper inherits
.dsg-flex[style*="--dsg-parent-hover-icon-bg"]:hover .dsg-flex__inner > .dsg-icon,
.dsg-grid[style*="--dsg-parent-hover-icon-bg"]:hover .dsg-grid__inner > .dsg-icon,
.dsg-stack[style*="--dsg-parent-hover-icon-bg"]:hover .dsg-stack__inner > .dsg-icon {
	background-color: var(--dsg-parent-hover-icon-bg) !important;
	transition: background-color 0.3s ease;
}
