/**
 * DSG Section Block - Frontend Styles
 *
 * Minimal frontend styles - WordPress handles flex layout through .is-layout-flex class.
 *
 * @package DesignSetGo
 */

.dsgo-stack {
	// CRITICAL: Ensure width includes padding to prevent overflow
	box-sizing: border-box;

	// CRITICAL: Flex column layout so .dsgo-stack__inner can fill available height
	// This enables vertical alignment (top/center/bottom/space-between) to work
	// when the section has a min-height set. Shape dividers are position: absolute
	// so they don't participate in this flex layout.
	display: flex;
	flex-direction: column;

	// Ensure background images respect border radius
	overflow: hidden;

	// Allow specific layouts (like scroll accordions) to opt out of clipping
	&.dsgo-stack--allow-overflow {
		overflow: visible;
	}

	// CRITICAL: Allow Navigation block dropdowns to overflow
	// Navigation menus need to display outside container bounds
	&:has(.wp-block-navigation) {
		overflow: visible;
	}

	// CRITICAL: Allow sticky positioned elements to work correctly
	// Sticky positioning requires overflow: visible on all ancestors
	&:has(.is-position-sticky),
	&:has([style*="position:sticky"]),
	&:has([style*="position: sticky"]) {
		overflow: visible;
	}

	// Position relative for hover overlay pseudo-element
	position: relative;

	// Hover background overlay - works with both gradients and solid colors
	// Using ::after pseudo-element allows smooth opacity transition
	// z-index: 0 (below overlay ::before and content)
	&[style*="--dsgo-hover-bg-color"]::after {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: var(--dsgo-hover-bg-color);
		opacity: 0;
		transition: opacity 0.3s ease;
		pointer-events: none;
		z-index: 0;
		border-radius: inherit;
	}

	// Ensure content is above all overlays
	// NOTE: This is overridden for overlay blocks (z-index: 2 on .dsgo-stack__inner)
	// IMPORTANT: Exclude shape dividers - they need position: absolute to stay at edges
	> *:not(.dsgo-stack__inner):not(.dsgo-shape-divider) {
		position: relative;
		z-index: 3;
	}

	/**
	 * Background overlay
	 * Only rendered when overlay color is set
	 */
	&--has-overlay {
		position: relative;

		&::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: var(--dsgo-overlay-color);
			opacity: var(--dsgo-overlay-opacity, 0.8);
			pointer-events: none; /* Allow clicks to pass through to content */
			z-index: 1; /* Above background image but below content */
			border-radius: inherit; /* Match parent border radius */
		}

		/* Ensure content is above overlay */
		> .dsgo-stack__inner {
			position: relative;
			z-index: 2;
		}
	}

	// CRITICAL: Inner container must be full width for layout to work
	// Width constraints are applied via inline styles when constrainWidth is enabled
	.dsgo-stack__inner {
		width: 100%;
		// CRITICAL: Fill available height so justify-content (vertical alignment) works
		// Without this, the inner div shrinks to content height and top/center/bottom/space-between
		// have no effect because there's no extra space to distribute
		flex-grow: 1;
		// CRITICAL: Position relative + z-index to ensure content stays above both overlays
		// z-index: 2 (above ::before overlay at z-index: 1 and ::after hover at z-index: 0)
		position: relative;
		z-index: 2;
	}

	// CRITICAL: When Section is nested inside another container, force full width
	// WordPress applies constrained layout which can limit width
	// This ensures nested Sections take full width of their parent container
	.dsgo-stack__inner > &,
	.dsgo-flex__inner > &,
	.dsgo-grid__inner > & {
		width: 100% !important;

		.dsgo-stack__inner {
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}
	}

	// CRITICAL: Disable float for all children in flex layout
	// WordPress core CSS applies float for alignment classes (.alignleft, .alignright)
	// but float should not work inside flex containers
	// NOTE: .is-layout-flex is on the dsgo-stack__inner element, not the outer wrapper
	.dsgo-stack__inner.is-layout-flex > * {
		float: none !important;
	}

	// CRITICAL: Ensure flex layout properties work correctly
	// WordPress applies these via inline styles, but we ensure they're respected
	// NOTE: .is-layout-flex is on the dsgo-stack__inner element, not the outer wrapper
	.dsgo-stack__inner.is-layout-flex {
		display: flex;
		flex-direction: column; // Vertical stacking

		// NOTE: align-items defaults to stretch (browser default).
		// Do NOT set align-items here â€” WordPress's layout system may generate
		// align-items based on content justification, and an explicit stretch
		// would override it, breaking Pill/Icon/Button alignment inheritance.

		// Inline blocks WITH explicit alignment - override section alignment
		> :where(
			.wp-block-designsetgo-icon,
			.wp-block-designsetgo-icon-button,
			.wp-block-designsetgo-pill,
			.wp-block-designsetgo-counter
		).aligncenter {
			align-self: center !important;
		}

		> :where(
			.wp-block-designsetgo-icon,
			.wp-block-designsetgo-icon-button,
			.wp-block-designsetgo-pill,
			.wp-block-designsetgo-counter
		).alignleft {
			align-self: flex-start !important;
		}

		> :where(
			.wp-block-designsetgo-icon,
			.wp-block-designsetgo-icon-button,
			.wp-block-designsetgo-pill,
			.wp-block-designsetgo-counter
		).alignright {
			align-self: flex-end !important;
		}

		// Block-level elements WITH explicit alignment
		> .aligncenter:not(.wp-block-designsetgo-icon):not(.wp-block-designsetgo-icon-button):not(.wp-block-designsetgo-pill):not(.wp-block-designsetgo-counter) {
			align-self: center !important;
		}

		> .alignright:not(.wp-block-designsetgo-icon):not(.wp-block-designsetgo-icon-button):not(.wp-block-designsetgo-pill):not(.wp-block-designsetgo-counter) {
			align-self: flex-end !important;
		}

		> .alignleft:not(.wp-block-designsetgo-icon):not(.wp-block-designsetgo-icon-button):not(.wp-block-designsetgo-pill):not(.wp-block-designsetgo-counter) {
			align-self: flex-start !important;
		}

		> .alignwide,
		> .alignfull {
			align-self: stretch !important;
			width: 100% !important;
		}
	}

	// ONLY apply full-width forcing when section has NO width constraints
	&.dsgo-no-width-constraint .dsgo-stack__inner.is-layout-flex {

		// CRITICAL: Inline/shrink-wrap blocks should respect alignment
		// These blocks should shrink to content width so they can be centered/aligned
		> .dsgo-pill,
		> .wp-block-button,
		> .wp-block-buttons,
		> .dsgo-icon-button,
		> .wp-block-designsetgo-icon-button {
			align-self: flex-start; // Override to allow alignment
			width: auto !important; // Shrink to content
			max-width: none !important; // Remove WordPress's 1200px contentSize constraint
		}

		// CRITICAL: Block-level elements take full width by default
		// Text blocks, groups, and most WordPress blocks
		> :where(
			.wp-block-heading,
			.wp-block-paragraph,
			.wp-block-group,
			.wp-block-image,
			.wp-block-video,
			.wp-block-embed,
			.wp-block-table,
			.wp-block-list,
			.dsgo-grid,
			.wp-block-designsetgo-grid,
			.dsgo-stack,
			.wp-block-designsetgo-stack,
			.dsgo-flex,
			.wp-block-designsetgo-flex,
			.wp-block-designsetgo-row,
			.dsgo-tabs,
			.wp-block-designsetgo-tabs,
			.dsgo-accordion,
			.wp-block-designsetgo-accordion,
			.dsgo-scroll-marquee,
			.wp-block-designsetgo-scroll-marquee
		):not(.alignleft):not(.alignright):not(.alignfull):not(.alignwide) {
			width: 100% !important;
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}

		// Old group structure (pre-6.0) with __inner-container
		> :where(.wp-block-group, .wp-block-designsetgo-stack, .dsgo-stack)
			:not(.alignleft):not(.alignright):not(.alignfull):not(.alignwide)
			> .wp-block-group__inner-container {
			width: 100% !important;
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}

		> :where(.wp-block-group, .dsgo-stack, .wp-block-designsetgo-stack)
			:is(.is-layout-constrained, .wp-block-group-is-layout-constrained)
			> .wp-block-group__inner-container {
			width: 100% !important;
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}

		// Modern group structure (6.0+) without __inner-container
		// Ensure nested groups take full width regardless of their layout type
		> .wp-block-group:not(.alignleft):not(.alignright):not(.alignfull):not(.alignwide) {
			width: 100% !important;
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
			// Ensure the block takes full width regardless of content
			min-width: 100% !important;
		}

		// Gap is handled by WordPress's blockGap support
	}

	// When width constraints ARE enabled, allow blocks to be constrained
	&:not(.dsgo-no-width-constraint) .dsgo-stack__inner.is-layout-flex {
		// Inline blocks still shrink to content
		> .dsgo-pill,
		> .dsgo-icon,
		> .wp-block-designsetgo-icon,
		> .wp-block-button,
		> .wp-block-buttons,
		> .dsgo-icon-button,
		> .wp-block-designsetgo-icon-button {
			align-self: flex-start;
			width: auto !important;
		}
	}

	// Section center alignment - apply to inline blocks WITHOUT their own alignment
	.dsgo-stack__inner.is-layout-flex.is-content-justification-center {

		> :where(
			.dsgo-pill,
			.wp-block-designsetgo-pill,
			.dsgo-icon,
			.wp-block-designsetgo-icon,
			.wp-block-button,
			.wp-block-buttons,
			.dsgo-icon-button,
			.wp-block-designsetgo-icon-button
		):not(.alignleft):not(.alignright):not(.aligncenter) {
			align-self: center;
		}
	}

	// Section right alignment - apply to inline blocks WITHOUT their own alignment
	.dsgo-stack__inner.is-layout-flex.is-content-justification-right {

		> :where(
			.dsgo-pill,
			.wp-block-designsetgo-pill,
			.dsgo-icon,
			.wp-block-designsetgo-icon,
			.wp-block-button,
			.wp-block-buttons,
			.dsgo-icon-button,
			.wp-block-designsetgo-icon-button
		):not(.alignleft):not(.alignright):not(.aligncenter) {
			align-self: flex-end;
		}
	}

	// Section left alignment - apply to inline blocks WITHOUT their own alignment
	.dsgo-stack__inner.is-layout-flex.is-content-justification-left {

		> :where(
			.dsgo-pill,
			.wp-block-designsetgo-pill,
			.dsgo-icon,
			.wp-block-designsetgo-icon,
			.wp-block-button,
			.wp-block-buttons,
			.dsgo-icon-button,
			.wp-block-designsetgo-icon-button
		):not(.alignleft):not(.alignright):not(.aligncenter) {
			align-self: flex-start;
		}
	}

	// Text alignment helpers for inline-width children
	&,
	&.has-text-align-left,
	&[style*='text-align:left'] {

		.dsgo-stack__inner.is-layout-flex
			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.dsgo-icon,
				.wp-block-designsetgo-icon,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			) {
			align-self: flex-start;
		}
	}

	&.has-text-align-center,
	&[style*='text-align:center'] {

		.dsgo-stack__inner.is-layout-flex
			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.dsgo-icon,
				.wp-block-designsetgo-icon,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			) {
			align-self: center;
		}
	}

	&.has-text-align-right,
	&[style*='text-align:right'] {

		.dsgo-stack__inner.is-layout-flex
			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.dsgo-icon,
				.wp-block-designsetgo-icon,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			) {
			align-self: flex-end;
		}
	}

	// Hover background and text colors using CSS custom properties
	// CRITICAL: Only apply hover when variables are actually set on THIS element
	&:hover {
		// Fade in the hover background overlay (::after pseudo-element)
		// This allows smooth transition from gradient to solid color
		&[style*="--dsgo-hover-bg-color"]::after {
			opacity: 1;
		}

		// Only apply text color if hover text color is set
		&[style*="--dsgo-hover-text-color"] {
			color: var(--dsgo-hover-text-color) !important;

			// Apply text color to all text elements for consistency
			h1, h2, h3, h4, h5, h6, p, a, span, li, td, th,
			.wp-block-heading,
			.wp-block-paragraph {
				color: var(--dsgo-hover-text-color) !important;
			}
		}
	}
}

// CRITICAL: Override WordPress's generated contentSize constraints for inline blocks
// WordPress generates rules like .wp-container-{block}-is-layout-{hash} > :where(...) { max-width: 1200px }
// We need to override these for blocks that should shrink to content
[class*="wp-container-designsetgo-stack"] {

	> .dsgo-pill,
	> .wp-block-designsetgo-pill,
	> .wp-block-button,
	> .wp-block-buttons,
	> .dsgo-icon-button,
	> .wp-block-designsetgo-icon-button {
		width: auto !important;
		max-width: none !important;
	}
}

// CRITICAL: When Stack is full-width (alignfull) AND has no width constraints, allow child blocks to go full-width
// WordPress constrains children with max-width: 1200px by default via generated classes like:
// .wp-container-designsetgo-stack-is-layout-{hash} > :where(:not(.alignleft):not(.alignright):not(.alignfull))
// The WordPress container class is on the INNER div, not the outer div
// We need higher specificity to override this
// IMPORTANT: Only apply when .dsgo-no-width-constraint class is present (constrainWidth is disabled)
.dsgo-stack.alignfull.dsgo-no-width-constraint > .dsgo-stack__inner[class*="wp-container-"] {

	// Target all direct children that aren't explicitly aligned
	> :not(.alignleft):not(.alignright) {
		max-width: none !important;
		margin-left: 0 !important;
		margin-right: 0 !important;
	}
}

/**
 * Shape Divider Styles
 *
 * Modern decorative shapes for section top/bottom.
 * Shapes are positioned at the edges of the section, and the inner
 * container receives automatic padding to clear the shape heights.
 *
 * Z-index hierarchy:
 * - Shape dividers (default): z-index 1
 * - Inner container: z-index 2
 * - Content children: z-index 3 (inherited from base styles)
 * - Shape dividers (front): z-index 10
 *
 * @since 1.4.2
 */
.dsgo-shape-divider {
	position: absolute;
	width: var(--dsgo-shape-width, 100%);
	height: var(--dsgo-shape-height, 100px);
	overflow: hidden;
	pointer-events: none;
	line-height: 0;
	z-index: 1;

	// Center the shape when width > 100%
	left: var(--dsgo-shape-offset, 0);

	// Apply background color if set
	background-color: var(--dsgo-shape-background, transparent);

	svg {
		display: block;
		width: 100%;
		height: 100%;
		fill: var(--dsgo-shape-color, currentColor);
	}

	// Top position - shape at the top edge of section
	&--top {
		top: 0;
	}

	// Bottom position - shape at the bottom edge of section
	&--bottom {
		bottom: 0;
	}

	// Bring to front - display above content
	&--front {
		z-index: 10;
	}
}

// When section has shape dividers, ensure proper stacking
.dsgo-stack--has-shape-divider {
	// Override base overflow:hidden to allow shapes to extend beyond bounds
	// Use !important to ensure precedence over base .dsgo-stack styles
	overflow-x: clip !important;
	overflow-y: visible !important;

	// Content stays above shapes (z-index: 2)
	// unless shape has "bring to front" option (z-index: 10)
	> .dsgo-stack__inner {
		position: relative;
		z-index: 2;
	}
}

// Respect user preference for reduced motion
@media (prefers-reduced-motion: reduce) {

	.dsgo-shape-divider svg {
		transition: none;
	}
}

// Print styles - hide decorative shapes
@media print {

	.dsgo-shape-divider {
		display: none;
	}
}
