/**
 * DSG Section Block - Editor Styles
 *
 * Minimal editor-only styles - WordPress handles flex layout through .is-layout-flex class.
 *
 * @package DesignSetGo
 */

.dsgo-stack {
	// CRITICAL: Ensure width includes padding to prevent overflow
	box-sizing: border-box;

	// Ensure background images respect border radius in editor
	overflow: hidden;

	// CRITICAL: Allow Navigation block dropdowns to overflow
	// Navigation menus need to display outside container bounds
	&:has(.wp-block-navigation) {
		overflow: visible;
	}

	// Visual indicator in editor
	position: relative;

	// Hover background overlay - works with both gradients and solid colors
	// Using ::after pseudo-element allows smooth opacity transition
	&[style*="--dsgo-hover-bg-color"]::after {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: var(--dsgo-hover-bg-color);
		opacity: 0;
		transition: opacity 0.3s ease;
		pointer-events: none;
		z-index: 0;
		border-radius: inherit;
	}

	// Ensure content is above hover overlay
	> *:not(.dsgo-stack__inner) {
		position: relative;
		z-index: 3;
	}

	/**
	 * Background overlay for editor
	 * Applied when overlay color is set
	 */
	&.dsgo-stack--has-overlay {

		&::before {
			content: '';
			position: absolute !important;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: var(--dsgo-overlay-color) !important;
			opacity: var(--dsgo-overlay-opacity, 0.8) !important;
			pointer-events: none;
			z-index: 1;
			border-radius: inherit;
		}

		/* Ensure content is above overlay */
		> .dsgo-stack__inner {
			position: relative;
			z-index: 2;
		}
	}

	// CRITICAL: Inner container must be full width for layout to work
	// When constrainWidth is enabled, inline styles will override with max-width
	.dsgo-stack__inner {
		width: 100%;
		// Ensure inner container doesn't create positioning context for absolute children
		position: static;
	}

	// When width constraints ARE enabled (no dsgo-no-width-constraint class)
	// Ensure child blocks don't exceed the inner container's max-width
	&:not(.dsgo-no-width-constraint) .dsgo-stack__inner.is-layout-flex > [data-block] {
		// Allow child blocks to be constrained by parent's max-width
		max-width: 100%;

		// Reset any forced full-width from WordPress or other sources
		> * {
			max-width: 100%;
		}
	}

	// CRITICAL: When section has content, position appender at outer container corner
	// Target from outer container to position relative to main block wrapper
	// Use :not(:only-child) to exclude empty section state
	/* stylelint-disable-next-line selector-class-pattern */
	.dsgo-stack__inner > .block-list-appender:not(:only-child) {
		// Remove from flex flow and position at outer container corner
		position: absolute;
		right: 0;
		bottom: 0;
		// Allow inserter button to position naturally
		width: auto;
		height: auto;
	}

	// CRITICAL: When section is empty, show normal appender
	/* stylelint-disable-next-line selector-class-pattern */
	.dsgo-stack__inner > .block-list-appender:only-child {
		position: static; // Reset positioning
	}

	// CRITICAL: When Section is nested inside another container, force full width (EDITOR)
	// WordPress applies constrained layout which can limit width
	// This ensures nested Sections take full width of their parent container
	// In editor, blocks are wrapped in [data-block] elements
	.dsgo-stack__inner > &,
	.dsgo-stack__inner > [data-block] &,
	.dsgo-flex__inner > &,
	.dsgo-flex__inner > [data-block] &,
	.dsgo-grid__inner > &,
	.dsgo-grid__inner > [data-block] & {
		width: 100% !important;

		.dsgo-stack__inner {
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}
	}

	// CRITICAL: Disable float for all children in flex layout (must match style.scss)
	// WordPress core CSS applies float for alignment classes (.alignleft, .alignright)
	// but float should not work inside flex containers
	// NOTE: .is-layout-flex is on the dsgo-stack__inner element, not the outer wrapper
	// In editor, children are wrapped in [data-block] elements
	.dsgo-stack__inner.is-layout-flex > *,
	.dsgo-stack__inner.is-layout-flex > [data-block] > * {
		float: none !important;
	}

	// CRITICAL: In editor, blocks are wrapped in [data-block] elements inside .dsgo-stack__inner
	// NOTE: .is-layout-flex is on the dsgo-stack__inner element, not the outer wrapper
	// ONLY apply when section has NO width constraints (dsgo-no-width-constraint class)
	&.dsgo-no-width-constraint .dsgo-stack__inner.is-layout-flex > [data-block] {
		// Auto width by default for alignment to work
		width: auto;
		max-width: 100%;

		// CRITICAL: Block-level element wrappers should take full width
		// This makes the wrapper stretch so the inner block can use its full width
		&[data-type="core/heading"],
		&[data-type="core/paragraph"],
		&[data-type="core/group"],
		&[data-type="core/image"],
		&[data-type="core/video"],
		&[data-type="core/embed"],
		&[data-type="core/table"],
		&[data-type="core/list"],
		&[data-type="designsetgo/grid"],
		&[data-type="designsetgo/section"],
		&[data-type="designsetgo/row"],
		&[data-type="designsetgo/stack"],
		&[data-type="designsetgo/flex"],
		&[data-type="designsetgo/tabs"],
		&[data-type="designsetgo/accordion"],
		&[data-type="designsetgo/scroll-marquee"] {
			width: 100%;

			> :where(
					.wp-block-heading,
					.wp-block-paragraph,
					.wp-block-group,
					.wp-block-image,
					.wp-block-video,
					.wp-block-embed,
					.wp-block-table,
					.wp-block-list,
					.dsgo-grid,
					.wp-block-designsetgo-grid,
					.dsgo-stack,
					.wp-block-designsetgo-stack,
					.dsgo-flex,
					.wp-block-designsetgo-flex,
					.wp-block-designsetgo-row,
					.dsgo-tabs,
					.wp-block-designsetgo-tabs,
					.dsgo-accordion,
					.wp-block-designsetgo-accordion,
					.dsgo-scroll-marquee,
					.wp-block-designsetgo-scroll-marquee
				):not(.alignleft):not(.alignright):not(.alignfull):not(.alignwide) {
				width: 100% !important;
				max-width: none !important;
				margin-left: 0 !important;
				margin-right: 0 !important;
			}
		}

		// Old group structure (pre-6.0) with __inner-container
		&[data-type="core/group"]
			> .wp-block-group
			> .wp-block-group__inner-container {
			width: 100% !important;
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}

		&[data-type="core/group"]
			> .wp-block-group.wp-block-group-is-layout-constrained
			> .wp-block-group__inner-container {
			width: 100% !important;
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}

		// Modern group structure (6.0+) without __inner-container
		// Target all layout types: flow, constrained, flex, grid
		// The .wp-block-group class is on the SAME element as data-type="core/group"
		&[data-type="core/group"].wp-block-group {
			width: 100% !important;
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;

			// Ensure the block takes full width regardless of content
			min-width: 100% !important;
		}
	}

	// Show outline when selected (editor-only)
	&.is-selected {
		outline: 1px dashed rgba(37, 99, 235, 0.3);
		outline-offset: -1px;
	}

	// Hover background and text colors using CSS custom properties (must match style.scss)
	// CRITICAL: Only apply hover when variables are actually set on THIS element
	&:hover {
		// Fade in the hover background overlay (::after pseudo-element)
		// This allows smooth transition from gradient to solid color
		&[style*="--dsgo-hover-bg-color"]::after {
			opacity: 1;
		}

		// Only apply text color if hover text color is set
		&[style*="--dsgo-hover-text-color"] {
			color: var(--dsgo-hover-text-color) !important;

			// Apply text color to all text elements for consistency
			h1, h2, h3, h4, h5, h6, p, a, span, li, td, th,
			.wp-block-heading,
			.wp-block-paragraph {
				color: var(--dsgo-hover-text-color) !important;
			}
		}
	}
}

// CRITICAL: Override WordPress's generated contentSize constraints for inline blocks (editor)
// WordPress generates rules like .wp-container-{block}-is-layout-{hash} > :where(...) { max-width: 1200px }
// We need to override these for blocks that should shrink to content
[class*="wp-container-designsetgo-stack"] {

	> [data-block] {

		> .dsgo-pill,
		> .wp-block-designsetgo-pill,
		> .wp-block-button,
		> .wp-block-buttons,
		> .dsgo-icon-button,
		> .wp-block-designsetgo-icon-button {
			width: auto !important;
			max-width: none !important;
		}
	}
}

// Text alignment helpers for inline-width children (editor)
.dsgo-stack,
.wp-block-designsetgo-stack {

	&,
	&.has-text-align-left,
	&[style*='text-align:left'] {

		.dsgo-stack__inner.is-layout-flex
			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			) {
			align-self: flex-start;
		}
	}

	&.has-text-align-center,
	&[style*='text-align:center'] {

		.dsgo-stack__inner.is-layout-flex
			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			) {
			align-self: center;
		}
	}

	&.has-text-align-right,
	&[style*='text-align:right'] {

		.dsgo-stack__inner.is-layout-flex
			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			) {
			align-self: flex-end;
		}
	}

	.dsgo-stack__inner.is-layout-flex {

		// Section center alignment - apply to inline blocks WITHOUT their own alignment
		&.is-content-justification-center {

			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			):not(.alignleft):not(.alignright):not(.aligncenter) {
				align-self: center;
			}
		}

		// Section right alignment - apply to inline blocks WITHOUT their own alignment
		&.is-content-justification-right {

			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			):not(.alignleft):not(.alignright):not(.aligncenter) {
				align-self: flex-end;
			}
		}

		// Section left alignment - apply to inline blocks WITHOUT their own alignment
		&.is-content-justification-left {

			> :where(
				.dsgo-pill,
				.wp-block-designsetgo-pill,
				.wp-block-button,
				.wp-block-buttons,
				.dsgo-icon-button,
				.wp-block-designsetgo-icon-button
			):not(.alignleft):not(.alignright):not(.aligncenter) {
				align-self: flex-start;
			}
		}

		// Inline blocks WITH explicit alignment - override section alignment
		> :where(
			.wp-block-designsetgo-icon,
			.wp-block-designsetgo-icon-button,
			.wp-block-designsetgo-pill,
			.wp-block-designsetgo-counter
		).aligncenter {
			align-self: center !important;
		}

		> :where(
			.wp-block-designsetgo-icon,
			.wp-block-designsetgo-icon-button,
			.wp-block-designsetgo-pill,
			.wp-block-designsetgo-counter
		).alignleft {
			align-self: flex-start !important;
		}

		> :where(
			.wp-block-designsetgo-icon,
			.wp-block-designsetgo-icon-button,
			.wp-block-designsetgo-pill,
			.wp-block-designsetgo-counter
		).alignright {
			align-self: flex-end !important;
		}

		// Block-level elements WITH explicit alignment
		> .aligncenter:not(.wp-block-designsetgo-icon):not(.wp-block-designsetgo-icon-button):not(.wp-block-designsetgo-pill):not(.wp-block-designsetgo-counter) {
			align-self: center !important;
		}

		> .alignright:not(.wp-block-designsetgo-icon):not(.wp-block-designsetgo-icon-button):not(.wp-block-designsetgo-pill):not(.wp-block-designsetgo-counter) {
			align-self: flex-end !important;
		}

		> .alignleft:not(.wp-block-designsetgo-icon):not(.wp-block-designsetgo-icon-button):not(.wp-block-designsetgo-pill):not(.wp-block-designsetgo-counter) {
			align-self: flex-start !important;
		}

		> .alignwide,
		> .alignfull {
			align-self: stretch !important;
			width: 100% !important;
		}
	}
}

// CRITICAL: When Stack is full-width (alignfull) AND has no width constraints, allow child blocks to go full-width (editor)
// WordPress constrains children with max-width: 1200px by default via generated classes like:
// .wp-container-designsetgo-stack-is-layout-{hash} > :where(:not(.alignleft):not(.alignright):not(.alignfull))
// In the EDITOR: WordPress container class is directly on the Stack block itself
// In the FRONTEND: WordPress container class is on the inner .dsgo-stack__inner div
// We need higher specificity to override this
// IMPORTANT: Only apply when .dsgo-no-width-constraint class is present (constrainWidth is disabled)
.dsgo-stack.alignfull.dsgo-no-width-constraint[class*="wp-container-"] {

	// Target all direct children that aren't explicitly aligned
	// In editor, children are wrapped in [data-block] elements
	> [data-block]:not(.alignleft):not(.alignright) {
		max-width: none !important;
		margin-left: 0 !important;
		margin-right: 0 !important;
	}
}
