/**
 * DSG Section Block - Editor Styles
 *
 * Minimal editor-only styles - WordPress handles flex layout through .is-layout-flex class.
 *
 * @package DesignSetGo
 */

.dsg-stack {
	// CRITICAL: Ensure width includes padding to prevent overflow
	box-sizing: border-box;

	// Smooth transition for hover background color
	transition: background-color 0.3s ease;

	// Visual indicator in editor
	position: relative;

	// CRITICAL: Inner container must be full width for layout to work
	// When constrainWidth is enabled, inline styles will override with max-width
	.dsg-stack__inner {
		width: 100%;
	}

	// CRITICAL: When Section is nested inside another container, force full width (EDITOR)
	// WordPress applies constrained layout which can limit width
	// This ensures nested Sections take full width of their parent container
	// In editor, blocks are wrapped in [data-block] elements
	.dsg-stack__inner > &,
	.dsg-stack__inner > [data-block] &,
	.dsg-flex__inner > &,
	.dsg-flex__inner > [data-block] &,
	.dsg-grid__inner > &,
	.dsg-grid__inner > [data-block] & {
		width: 100% !important;

		.dsg-stack__inner {
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}
	}

	// CRITICAL: Disable float for all children in flex layout (must match style.scss)
	// WordPress core CSS applies float for alignment classes (.alignleft, .alignright)
	// but float should not work inside flex containers
	// In editor, children are wrapped in [data-block] elements
	// With two-div structure: .dsg-stack.is-layout-flex > .dsg-stack__inner > [data-block]
	&.is-layout-flex .dsg-stack__inner > *,
	&.is-layout-flex .dsg-stack__inner > [data-block] > * {
		float: none !important;
	}

	// CRITICAL: In editor, blocks are wrapped in [data-block] elements inside .dsg-stack__inner
	// Layout class is on outer .dsg-stack, not on .dsg-stack__inner
	&.is-layout-flex .dsg-stack__inner > [data-block] {
		// Auto width by default for alignment to work
		width: auto;
		max-width: 100%;

		// CRITICAL: Block-level element wrappers should take full width
		// This makes the wrapper stretch so the inner block can use its full width
		&[data-type="core/heading"],
		&[data-type="core/paragraph"],
		&[data-type="core/group"],
		&[data-type="core/image"],
		&[data-type="core/video"],
		&[data-type="core/embed"],
		&[data-type="core/table"],
		&[data-type="core/list"],
		&[data-type="designsetgo/grid"],
		&[data-type="designsetgo/section"],
		&[data-type="designsetgo/row"],
		&[data-type="designsetgo/stack"],
		&[data-type="designsetgo/flex"] {
			width: 100%;
		}
	}

	// Show outline when selected (editor-only)
	&.is-selected {
		outline: 1px dashed rgba(37, 99, 235, 0.3);
		outline-offset: -1px;
	}

	// Hover background and text colors using CSS custom properties (must match style.scss)
	// CRITICAL: Only apply hover when variables are actually set on THIS element
	&:hover {
		// Only apply background if hover background is set
		// !important needed to override WordPress color classes (e.g., .has-accent-2-background-color)
		&[style*="--dsg-hover-bg-color"] {
			background-color: var(--dsg-hover-bg-color) !important;
		}

		// Only apply text color if hover text color is set
		&[style*="--dsg-hover-text-color"] {
			color: var(--dsg-hover-text-color) !important;

			// Apply text color to all text elements for consistency
			h1, h2, h3, h4, h5, h6, p, a, span, li, td, th,
			.wp-block-heading,
			.wp-block-paragraph {
				color: var(--dsg-hover-text-color) !important;
			}
		}
	}
}

// CRITICAL: Override WordPress's generated contentSize constraints for inline blocks (editor)
// WordPress generates rules like .wp-container-{block}-is-layout-{hash} > :where(...) { max-width: 1200px }
// We need to override these for blocks that should shrink to content
[class*="wp-container-designsetgo-stack"] {

	> [data-block] {

		> .dsg-pill,
		> .wp-block-designsetgo-pill,
		> .wp-block-button,
		> .wp-block-buttons {
			width: auto !important;
			max-width: none !important;
		}
	}
}

// CRITICAL: When Stack is full-width (alignfull) AND has no width constraints, allow child blocks to go full-width (editor)
// WordPress constrains children with max-width: 1200px by default via generated classes like:
// .wp-container-designsetgo-stack-is-layout-{hash} > :where(:not(.alignleft):not(.alignright):not(.alignfull))
// In the EDITOR: WordPress container class is directly on the Stack block itself
// In the FRONTEND: WordPress container class is on the inner .dsg-stack__inner div
// We need higher specificity to override this
// IMPORTANT: Only apply when .dsg-no-width-constraint class is present (constrainWidth is disabled)
.dsg-stack.alignfull.dsg-no-width-constraint[class*="wp-container-"] {

	// Target all direct children that aren't explicitly aligned
	// In editor, children are wrapped in [data-block] elements
	> [data-block]:not(.alignleft):not(.alignright) {
		max-width: none !important;
		margin-left: 0 !important;
		margin-right: 0 !important;
	}
}
