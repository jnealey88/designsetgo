/**
 * Utility Classes
 *
 * @package DesignSetGo
 */

@use 'mixins' as *;

// Import sticky header utilities
@use 'utilities/sticky-header';

// Responsive visibility
.dsgo-hide-desktop {

	@include desktop-up {
		display: none !important;
	}
}

.dsgo-hide-tablet {

	@include tablet {
		display: none !important;
	}
}

.dsgo-hide-mobile {

	@include mobile-only {
		display: none !important;
	}
}

// Accessibility
.dsgo-sr-only {
	position: absolute;
	width: 1px;
	height: 1px;
	padding: 0;
	margin: -1px;
	overflow: hidden;
	clip: rect(0, 0, 0, 0);
	white-space: nowrap;
	border-width: 0;
}

// Focus styles: Only show outline for keyboard navigation (toggled via JS)
body:not(.dsgo-show-focus-outlines) :where(.wp-site-blocks *:focus) {
	outline: none;
}

body.dsgo-show-focus-outlines :where(.wp-site-blocks *:focus-visible) {
	outline-width: 2px;
	outline-style: solid;
	outline-color: var(--wp--preset--color--contrast, currentColor);
	outline-offset: 2px;
}

@supports not selector(:focus-visible) {

	body.dsgo-show-focus-outlines :where(.wp-site-blocks *:focus) {
		outline-width: 2px;
		outline-style: solid;
		outline-color: var(--wp--preset--color--contrast, currentColor);
		outline-offset: 2px;
	}
}

// Clearfix
.dsgo-clearfix::after {
	content: '';
	display: table;
	clear: both;
}

/**
 * Separator Fix
 * Ensures separators display correctly within container blocks
 * by restoring WordPress core's expected border behavior
 */
.wp-block-separator {
	// Ensure border displays (override theme.json if needed)
	border-top-width: 2px !important;
	border-bottom-width: 0 !important;
	border-style: solid !important;

	// Ensure border has a visible color with fallback
	// Uses currentColor if text color is set, otherwise falls back to theme contrast color
	border-color: currentcolor;

	// Fallback for when currentColor is transparent
	&:not([class*="has-"]) {
		border-color: var(--wp--preset--color--contrast, rgba(0, 0, 0, 0.1));
	}
}

// No custom alignfull overrides - let WordPress handle it natively

/**
 * WordPress Core Post Content Fix
 * Fixes horizontal overflow when post content has both alignfull and is-layout-constrained
 * Must match editor.scss for editor/frontend parity
 * IMPORTANT: box-sizing must be border-box so padding is included in width calculation
 */
/* stylelint-disable selector-class-pattern */
.entry-content.alignfull.is-layout-constrained,
.wp-block-post-content.alignfull.is-layout-constrained,
.entry-content.alignfull.is-layout-constrained.has-global-padding,
.wp-block-post-content.alignfull.is-layout-constrained.has-global-padding {
	box-sizing: border-box;
	max-width: 100%;
}
/* stylelint-enable selector-class-pattern */

/**
 * ============================================================================
 * CONTAINER CHILD WIDTH STRATEGY
 * ============================================================================
 *
 * Centralized width and layout rules for container blocks and their children.
 * Defines how child blocks behave inside Section/Row/Grid containers.
 *
 * By default, all blocks inside containers should span the full width of their
 * parent container for consistent behavior and predictable layouts.
 */

/**
 * A. Full-Width Blocks (Default Behavior)
 * All blocks inside container inner divs default to full width
 */
.dsgo-stack__inner,
.dsgo-flex__inner,
.dsgo-grid__inner {

	> .wp-block {
		width: 100%;
		max-width: none;
	}

	/**
	 * B. Intrinsic Width Blocks (Inline Elements)
	 * These blocks maintain their natural inline sizing
	 */
	> .wp-block-designsetgo-icon,
	> .wp-block-designsetgo-icon-button,
	> .wp-block-designsetgo-pill {
		width: fit-content !important;
		max-width: fit-content !important;
		display: inline-flex;
	}

	> .wp-block-designsetgo-counter:not([style*="width"]) {
		width: auto;
		display: inline-flex;
	}

	/**
	 * C. WordPress Alignment Classes (User-Controlled Width)
	 */
	> .alignleft {
		width: auto;
		max-width: 50%;
		margin-right: 2em;
		float: left;
	}

	> .alignright {
		width: auto;
		max-width: 50%;
		margin-left: 2em;
		float: right;
	}

	/**
	 * Aligncenter - ONLY for block-level elements
	 * Inline blocks (icon button, pill) should use flexbox alignment instead
	 */
	> .aligncenter:not(.wp-block-designsetgo-icon):not(.wp-block-designsetgo-icon-button):not(.wp-block-designsetgo-pill):not(.wp-block-designsetgo-counter) {
		width: auto;
		margin-left: auto;
		margin-right: auto;
	}

	/**
	 * Alignfull breakout - ONLY for non-container blocks
	 * Container blocks are handled separately in section D
	 */
	> .alignfull:not(.wp-block-designsetgo-section):not(.wp-block-designsetgo-row):not(.wp-block-designsetgo-grid) {
		width: 100vw;
		max-width: 100vw;
		margin-left: calc(50% - 50vw);
		margin-right: calc(50% - 50vw);
	}

	> .alignwide {
		width: 100%;
		max-width: var(--wp--custom--layout--wide-size, 1200px);
		margin-left: auto;
		margin-right: auto;
	}

	/**
	 * D. Nested Container Behavior
	 * Nested containers span full width of parent and can set their own constraints
	 * Container blocks should NEVER use viewport breakout (calc(50% - 50vw))
	 */
	> .wp-block-designsetgo-section,
	> .wp-block-designsetgo-row,
	> .wp-block-designsetgo-grid {
		width: 100% !important;

		> .dsgo-stack__inner,
		> .dsgo-flex__inner,
		> .dsgo-grid__inner {
			max-width: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}
	}

	/**
	 * E. Interactive Blocks - Always Full Width
	 */
	> .wp-block-designsetgo-accordion,
	> .wp-block-designsetgo-tabs {
		width: 100% !important;
		max-width: none !important;
	}
}

/**
 * No Width Constraint Mode
 * When container has constrainWidth=false, ensure no artificial limits
 */
.dsgo-stack.dsgo-no-width-constraint,
.dsgo-flex.dsgo-no-width-constraint,
.dsgo-grid.dsgo-no-width-constraint {

	> .dsgo-stack__inner,
	> .dsgo-flex__inner,
	> .dsgo-grid__inner {

		> :not(.alignleft):not(.alignright) {
			max-width: none !important;
		}
	}
}
