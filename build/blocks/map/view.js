(()=>{"use strict";const e={silver:[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#d6d6d6"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#b3b3b3"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]}],dark:[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212121"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1c1c1c"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#263238"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]}]};class t{constructor(e){this.element=e,this.config=this.parseConfig(),this.mapInstance=null,this.loadMapBound=this.loadMap.bind(this),this.config.privacyMode?this.setupPrivacyMode():this.loadMap()}parseConfig(){const e=this.element.dataset,t=parseFloat(e.dsgoLat),o=parseFloat(e.dsgoLng),r=parseInt(e.dsgoZoom);return{provider:e.dsgoProvider||"openstreetmap",lat:Number.isFinite(t)?Math.max(-90,Math.min(90,t)):0,lng:Number.isFinite(o)?Math.max(-180,Math.min(180,o)):0,zoom:Number.isInteger(r)&&r>=1&&r<=20?r:13,address:e.dsgoAddress||"",markerIcon:e.dsgoMarkerIcon||"ðŸ“",markerColor:e.dsgoMarkerColor||"#e74c3c",markerPopup:e.dsgoMarkerPopup||"",grayscale:"true"===e.dsgoGrayscale,privacyMode:"true"===e.dsgoPrivacyMode,apiKey:e.dsgoApiKey||"",mapStyle:e.dsgoMapStyle||"standard"}}setupPrivacyMode(){const e=this.element.querySelector(".dsgo-map__load-button");e&&e.addEventListener("click",this.loadMapBound)}async loadMap(){try{"googlemaps"===this.config.provider?await async function(t){await async function(e){if(!e)throw new Error("Google Maps API key is required");if(!window.google?.maps?.importLibrary)return new Promise((t,o)=>{try{(e=>{let t,o,r;const a="The Google Maps JavaScript API",n="google",s="importLibrary",l="__ib__",i=document,c=window;c[n]=c[n]||{};const p=c[n].maps||(c[n].maps={}),d=new Set,m=new URLSearchParams;p[s]?console.warn(a+" only loads once. Ignoring:",e):p[s]=(c,...y)=>d.add(c)&&(t||(t=new Promise(async(s,c)=>{for(r in await(o=i.createElement("script")),m.set("libraries",[...d]+""),e)m.set(r.replace(/[A-Z]/g,e=>"_"+e[0].toLowerCase()),e[r]);m.set("callback",n+".maps."+l),o.src="https://maps.googleapis.com/maps/api/js?"+m,p[l]=s,o.onerror=()=>t=c(Error(a+" could not load.")),o.nonce=i.querySelector("script[nonce]")?.nonce||"",i.head.append(o)}))).then(()=>p[s](c,...y))})({key:e,v:"weekly"}),t()}catch(e){o(new Error("Failed to initialize Google Maps: "+e.message))}})}(t.config.apiKey);const{Map:o}=await window.google.maps.importLibrary("maps"),{AdvancedMarkerElement:r,PinElement:a}=await window.google.maps.importLibrary("marker");let n=t.element.querySelector(".dsgo-map__container");n||(n=document.createElement("div"),n.className="dsgo-map__container",n.setAttribute("role","region"),n.setAttribute("aria-label","Map"),t.element.appendChild(n));const s={center:{lat:t.config.lat,lng:t.config.lng},zoom:t.config.zoom,mapId:"dsgo-map-"+Math.random().toString(36).substr(2,9)};"standard"!==t.config.mapStyle&&e[t.config.mapStyle]&&(s.styles=e[t.config.mapStyle]),t.mapInstance=new o(n,s);const l=new a({background:t.config.markerColor||"#e74c3c",borderColor:"#ffffff",glyphColor:"#ffffff",scale:1.2});new r({map:t.mapInstance,position:{lat:t.config.lat,lng:t.config.lng},content:l.element})}(this):await async function(e){await async function(){const e="https://unpkg.com/leaflet@1.9.4";var t,o;if(await(t=`${e}/dist/leaflet.css`,o="leaflet-css",new Promise((e,r)=>{if(document.getElementById(o))return void e();const a=document.createElement("link");a.id=o,a.rel="stylesheet",a.href=t,a.onload=()=>e(),a.onerror=()=>r(new Error(`Failed to load: ${t}`)),document.head.appendChild(a)})),await function(e,t){return new Promise((o,r)=>{if(document.getElementById(t))return void o();const a=document.createElement("script");a.id=t,a.src=e,a.async=!0,a.onload=()=>o(),a.onerror=()=>r(new Error(`Failed to load: ${e}`)),document.head.appendChild(a)})}(`${e}/dist/leaflet.js`,"leaflet-js"),void 0===window.L)throw new Error("Leaflet failed to initialize")}();let t=e.element.querySelector(".dsgo-map__container");t||(t=document.createElement("div"),t.className="dsgo-map__container",t.setAttribute("role","region"),t.setAttribute("aria-label","Map"),e.element.appendChild(t)),e.mapInstance=window.L.map(t,{center:[e.config.lat,e.config.lng],zoom:e.config.zoom}),window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(e.mapInstance);const o=document.createElement("div");o.textContent=e.config.markerIcon,o.style.cssText="\n\t\tfont-size: 32px;\n\t\tline-height: 1;\n\t\ttext-align: center;\n\t\tfilter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));\n\t";const r=window.L.divIcon({html:o.outerHTML,className:"dsgo-map__custom-marker",iconSize:[32,32],iconAnchor:[16,32]});window.L.marker([e.config.lat,e.config.lng],{icon:r}).addTo(e.mapInstance)}(this);const t=this.element.querySelector(".dsgo-map__privacy-overlay");t&&(t.style.display="none");const o=this.element.querySelector(".dsgo-map__container");o&&this.config.privacyMode&&(o.setAttribute("tabindex","-1"),o.focus())}catch(e){console.error("Failed to load map:",e),this.showError("Failed to load map. Please check your settings.")}}showError(e){const t=document.createElement("div");t.className="dsgo-map__error",t.textContent=e,t.style.cssText="\n\t\t\tpadding: 20px;\n\t\t\ttext-align: center;\n\t\t\tcolor: #d63638;\n\t\t\tbackground: #fef7f7;\n\t\t\tborder: 1px solid #f0c0c0;\n\t\t\tborder-radius: 4px;\n\t\t";const o=this.element.querySelector(".dsgo-map__privacy-overlay");o&&(o.style.display="none"),this.element.appendChild(t)}destroy(){if(this.config.privacyMode){const e=this.element.querySelector(".dsgo-map__load-button");e&&e.removeEventListener("click",this.loadMapBound)}if(this.mapInstance){try{"openstreetmap"===this.config.provider&&this.mapInstance.remove?this.mapInstance.remove():"googlemaps"===this.config.provider&&window.google}catch(e){console.error("Error cleaning up map:",e)}this.mapInstance=null}this.element=null}}function o(){document.querySelectorAll(".dsgo-map").forEach(e=>{e.hasAttribute("data-dsgo-initialized")||(e.setAttribute("data-dsgo-initialized","true"),new t(e))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o(),window.DSGMap=t})();