document.addEventListener("DOMContentLoaded",function(){function e(e,t,o){e.textContent=t,e.className=`dsgo-form__message dsgo-form__message--${o}`,e.style.display="block",e.setAttribute("role","error"===o?"alert":"status");const s=document.createElement("span");s.className="screen-reader-text",s.textContent=t,s.setAttribute("aria-live","polite"),e.appendChild(s)}document.querySelectorAll(".dsgo-form-builder").forEach(t=>{const o=t.querySelector(".dsgo-form"),s=o?.querySelector(".dsgo-form__submit"),r=o?.querySelector(".dsgo-form__message");if(!o||!s||!r)return;const a=document.createElement("input");if(a.type="hidden",a.name="dsg_timestamp",a.value=Date.now(),o.appendChild(a),"true"!==t.getAttribute("data-ajax-submit"))return;const i=t.getAttribute("data-form-id"),n=t.getAttribute("data-success-message"),m=t.getAttribute("data-error-message"),d=t.getAttribute("data-enable-email"),l=t.getAttribute("data-email-to"),u=t.getAttribute("data-email-subject"),c=t.getAttribute("data-email-from-name"),g=t.getAttribute("data-email-from-email"),b=t.getAttribute("data-email-reply-to"),f=t.getAttribute("data-email-body");o.addEventListener("submit",async function(a){var _;if(a.preventDefault(),(_=r).style.display="none",_.textContent="",_.className="dsgo-form__message",!o.checkValidity())return void o.reportValidity();s.disabled=!0,s.classList.add("dsgo-form__submit--loading");const p=s.textContent;s.setAttribute("aria-busy","true");const y=new FormData(o),h=[];for(const[e,t]of y.entries()){if("dsg_website"===e||"dsg_form_id"===e||"dsg_timestamp"===e)continue;const s=o.querySelector(`[name="${e}"]`),r=s?.getAttribute("data-field-type")||s?.type||"text";h.push({name:e,value:t,type:r})}const A=y.get("dsg_website"),w=y.get("dsg_timestamp");try{const s=await fetch(designsetgoForm.restUrl,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":designsetgoForm.nonce},body:JSON.stringify({formId:i,fields:h,honeypot:A||"",timestamp:w||Date.now(),enable_email:d,email_to:l,email_subject:u,email_from_name:c,email_from_email:g,email_reply_to:b,email_body:f})}),a=await s.json();if(!a.success)throw new Error(a.message||m);e(r,n||a.message,"success"),o.reset(),t.dispatchEvent(new CustomEvent("dsgoFormSubmitted",{detail:{formId:i,submissionId:a.submissionId},bubbles:!0})),function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(r)||r.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(o){console.error("Form submission error:",o),e(r,o.message||m||"An error occurred. Please try again.","error"),t.dispatchEvent(new CustomEvent("dsgoFormError",{detail:{formId:i,error:o.message},bubbles:!0}))}finally{s.disabled=!1,s.classList.remove("dsgo-form__submit--loading"),s.textContent=p,s.removeAttribute("aria-busy")}})})});